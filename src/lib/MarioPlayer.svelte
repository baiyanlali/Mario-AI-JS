<script lang="ts">
    import "../app.css";
    import { onDestroy, onMount } from "svelte";
    import HumanAgent from "../logics/agents/HumanAgent.js";
    import MarioGame from "../logics/engine/core/MarioGame.js";
    import Replay from "../logics/engine/helper/Replay.js";

    export let game_div: HTMLDivElement;
    let game: MarioGame;

    async function getLevel(filepath: string) {
        let response = await fetch(filepath);
        return await response.text();
    }

    async function getAgent(repPath: string) {
        return Replay.getRepAgentFromFile(repPath);
    }

    onMount(() => {
        game = new MarioGame(game_div);
        let levelPath: string = "./levels/lvl73.lvl"; // For local
        let repPath: string =
            "./reps/b179cbd3-ee8e-48de-baf8-da6438461d1d_lvl155.rep";
        const level = `----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------g-----------------------------------------------------------------------------------------------------------------------
----------------------!---------------------------------------------------------SSSSSSSS---SSS!--------------@-----------SSS----S!!S--------------------------------------------------------##------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------###------------
-------------------------------------------------------------------------------g----------------------------------------------------------------------------------------------------------####------------
----------------------------------------------------------------1------------------------------------------------------------------------------------------------------------------------#####------------
----------------!---S@S!S---------------------tt---------tt------------------S@S--------------C-----SU----!--!--!-----S----------SS------#--#----------##--#------------SS!S------------######------------
--------------------------------------tt------tt---------tt-----------------------------------------------------------------------------##--##--------###--##--------------------------#######------------
----------------------------tt--------tt------tt---------tt----------------------------------------------------------------------------###--###------####--###-----tt--------------tt-########--------F---
---M-----------------g------tt--------tt-g----tt-----g-g-tt------------------------------------g-g--------k-----------------gg-g-g----####--####----#####--####----tt---------gg---tt#########--------#---
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX--XXXXXXXXXXXXXXX---XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX--XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX--XXXXXXXXXXXXXXX---XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX--XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX`;
        game.init().then(() => {
            console.log(game_div);
            let agent = new HumanAgent();
            let result = game.playGame(agent, level, 60, repPath, 30);
        });
    });

    onDestroy(()=> {
        game.destroy();
    })
</script>

<div class="grid grid-cols-1 gap-4">
    <div bind:this={game_div}>

    </div>
</div>


<style lang="postcss">
    @refernce "tailwindcss/theme";
</style>